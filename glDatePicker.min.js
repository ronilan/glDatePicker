(function(){$.fn.glDatePicker=function(c){var A=this.data("glDatePicker");return A?!0===c?A:this:this.each(function(){return $(this).data("glDatePicker",new Q(this,c))})};$.fn.glDatePicker.defaults={cssName:"default",zIndex:1E3,borderSize:1,calendarOffset:{x:0,y:1},showAlways:!1,showAlwaysAlways:!1,resizeable:!0,hideOnClick:!0,allowMonthSelect:!0,allowYearSelect:!0,todayDate:new Date,selectedDate:null,prevArrow:"\u25c4",nextArrow:"\u25ba",selectableDates:null,selectableDateRange:null,specialDates:null,
selectableMonths:null,selectableYears:null,selectableDOW:null,monthNames:null,dowNames:null,dowOffset:0,onClick:function(c,A,g,f){c.val(g.toLocaleDateString())},onHold:function(c,A,g,f){c.val(g.toLocaleDateString())},onHover:function(c,A,g,f){},onShow:function(c){c.show()},onHide:function(c){c.hide()},firstDate:null};var Q=function(){function c(c,g){var f=this;f.el=$(c);var a=f.el;f.options=$.extend(!0,{},$.fn.glDatePicker.defaults,g);var b=f.options;f.calendar=$($.find("[gldp-el="+a.attr("gldp-id")+
" ]"));b.selectedDate=b.selectedDate||b.todayDate;b.firstDate=(new Date(b.firstDate||b.selectedDate))._first();(a.attr("gldp-id")||"").length||a.attr("gldp-id","gldp-"+Math.round(1E10*Math.random()));a.addClass("gldp-el").bind("click",function(a){f.show(a)}).bind("focus",function(a){f.show(a)});f.calendar.length&&!b.showAlways&&f.calendar.hide();$(document).bind("mouseup",function(c){c=c.target;var b=f.calendar;a.is(c)||(b.is(c)||0!==b.has(c).length||!b.is(":visible"))||f.hide()});f.render()}c.prototype=
{show:function(){$.each($(".gldp-el").not(this.el),function(c,g){if(g.length)g.options.onHide(g.calendar)});this.options.onShow(this.calendar)},hide:function(){if(this.options&&!this.options.showAlways)this.options.onHide(this.calendar)},render:function(c){var g=this,f=g.el,a=g.options,b=g.calendar,p="gldp-"+a.cssName,v=a.todayDate._val(),w=v.time,l=a.borderSize+"px",B=function(a,e,c){for(var b=[],d=a;d<=e;d++)b.push(d);if(c){var f=[];$.each(c,function(c,b){b>=a&&(b<=e&&0>f._indexOf(b))&&f.push(b)});
b=f.length?f:b}b.sort();return b},J=B(0,11,a.selectableMonths),x=B(v.year-5,v.year+5,a.selectableYears),B=B(0,6,a.selectableDOW),C=a.dowNames||"Sun Mon Tue Wed Thu Fri Sat".split(" "),v=a.monthNames||"January February March April May June July August September October November December".split(" "),h=f.outerWidth(),d=h,k=function(m,e){return Math.floor(m/e+a.borderSize/e*(e-1))},h=k(h,7),d=k(d,8);b.length?eval(b.data("is"))||(h=b.outerWidth(),d=b.outerHeight(),h=k(h,7),d=k(d,8)):(g.calendar=b=$("<div/>").attr("gldp-el",
f.attr("gldp-id")).data("is",!0).css({display:a.showAlways?void 0:"none",zIndex:a.zIndex,width:7*h+"px"}),$("body").append(b));a.showAlwaysAlways||f.is(":visible")||b.hide();b.removeClass().addClass(p).children().remove();p=function(){if(a.resizeable){var m=f.offset();b.css({top:m.top+f.outerHeight()+a.calendarOffset.y+"px",left:m.left+a.calendarOffset.x+"px"})}};$(window).resize(p);p();var p={width:h+"px",height:d+"px",lineHeight:d+"px"},k=function(m){var e=new Date(a.firstDate);for(m=m||0;;){e.setMonth(e.getMonth()+
m);e.setDate(Math.min(1,e._max()));if(0==m)break;var b=e._val(),c=b.year;if(-1!=J._indexOf(b.month))if(-1!=x._indexOf(c))break;else if(c<x[0]||c>x[x.length-1])return null}return e},D=k(-1),E=k(1),k=a.firstDate=k(),d=k._val(),K=d.month,L=d.year,k=new Date(k),d=Math.abs(Math.min(6,Math.max(0,a.dowOffset))),q=k.getDay()-d,q=1>q?-7-q:-q,C=C.concat(C).slice(d,d+7);k._add(q);d=$("<div/>").addClass(" core border monyear ").css($.extend({},p,{borderWidth:l+" 0 0 "+l})).append($("<a/>").addClass("prev-arrow"+
(D?"":"-off")).html(a.prevArrow)).mousedown(function(){return!1}).click(function(m){""!=a.prevArrow&&D&&(m.stopPropagation(),D&&(a.firstDate=D,g.render()))});h=5*h-5*a.borderSize+a.borderSize;h=$("<div/>").addClass(" core border monyear title").css($.extend({},p,{width:h+"px",borderTopWidth:l,marginLeft:"-"+l}));q=$("<div/>").addClass(" core border monyear ").css($.extend({},p,{marginLeft:"-"+l,borderWidth:l+" "+l+" 0 0"})).append($("<a/>").addClass("next-arrow"+(E?"":"-off")).html(a.nextArrow)).mousedown(function(){return!1}).click(function(m){""!=
a.nextArrow&&E&&(m.stopPropagation(),E&&(a.firstDate=E,g.render()))});b.append(d).append(h).append(q);for(q=d=0;7>d;d++)for(var s=0;7>s;s++,q++){var F=new Date(k),n="day",t=a.zIndex+q,y=$("<div/>");if(d){F._add(s+7*(d-1));var r=F._val(),z=r.time,M=null,u=!0,G=function(a,e){!0===a.repeatYear&&e.setYear(r.year);!0===a.repeatMonth&&e.setMonth(r.month);return e._val()};y.html(r.date);a.selectableDateRange&&(u=!1,$.each(a.selectableDateRange,function(a,e){var c=e.from,b=e.to||null,b=b||new Date(e.from.getFullYear(),
e.from.getMonth(),e.from._max()),c=G(e,c),b=G(e,b);if(z>=c.time&&z<=b.time)return u=!0}));if(a.selectableDates){if(a.selectableDateRange&&!u||u&&!a.selectableDateRange)u=!1;$.each(a.selectableDates,function(a,b){if(G(b,b.date).time==z)return u=!0})}!u||0>x._indexOf(r.year)||0>J._indexOf(r.month)||0>B._indexOf(r.day)?n="noday":(n="sun mon tue wed thu fri sat".split(" ")[r.day],K!=r.month&&(n+=" outday"),w==z&&(n="today",t+=50),a.specialDates&&$.each(a.specialDates,function(a,b){G(b,b.date).time==z&&
(n=b.cssClass||"special",t+=52,M=b.data)}),a.selectedDate._time()==z&&(n+=" selected",t+=1E3),a.holdSelectDate&&(n+=" hold-selected"),y.on("click",function(c){c.stopPropagation();c=$(this).data("data");a.selectedDate=a.firstDate=c.date;a=a.onClick(b,$(this),c.date,c.data);a.holdSelectDate=null;g.render(function(){!a.showAlways&&a.hideOnClick&&g.hide()})}).on("touchstart",function(c){var e=$(this).data("data");a.selectedDate=a.firstDate=e.date;$_this=$(this);timer=setTimeout(function(){a.holdSelectDate?
(a=a.onClick(b,$_this,e.date,e.data),a.holdSelectDate=null):(a.holdSelectDate=a.selectedDate,a=a.onHold(b,$_this,e.date,e.data));g.render()},750)}).on("touchend",function(a){window.clearTimeout(timer)}).on("mousedown",function(){return!1}).on("hover",function(b){b.stopPropagation();b=$(this).data("data");a.onHover(f,y,b.date,b.data)}))}else n="dow",y.html(C[s]),F=null;$.extend(p,{borderTopWidth:l,borderBottomWidth:l,borderLeftWidth:0<d||!d&&!s?l:0,borderRightWidth:0<d||!d&&6==s?l:0,marginLeft:0<s?
"-"+l:0,marginTop:0<d?"-"+l:0,zIndex:t});y.data("data",{date:F,data:M}).addClass(" core border "+n).css(p);b.append(y)}var P=function(b){a.allowMonthSelect&&(N.css({display:b?"inline-block":"none"}),H.css({display:b?"none":"inline-block"}));a.allowYearSelect&&(O.css({display:b?"none":"inline-block"}),I.css({display:b?"inline-block":"none"}))},w=function(){a.firstDate=new Date(I.val(),H.val(),1);g.render()},H=$("<select/>").hide().change(w),I=$("<select/>").hide().change(w),N=$("<span/>").html(v[K]).mousedown(function(){return!1}).click(function(a){a.stopPropagation();
P(!1)}),O=$("<span/>").html(L).mousedown(function(){return!1}).click(function(a){a.stopPropagation();P(!0)});$.each(v,function(b,c){if(a.allowMonthSelect&&-1!=J._indexOf(b)){var d=$("<option/>").html(c).attr("value",b);b==K&&d.attr("selected","selected");H.append(d)}});$.each(x,function(b,c){if(a.allowYearSelect){var d=$("<option/>").html(c).attr("value",c);c==L&&d.attr("selected","selected");I.append(d)}});w=$("<div/>").append(N).append(H).append(O).append(I);h.children().remove();h.append(w);(c||
function(){})()}};return c}();(function(){Date.prototype._clear=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype._time=function(){return this._clear().getTime()};Date.prototype._max=function(){return[31,28+(1==(new Date(this.getYear(),1,29)).getMonth()?1:0),31,30,31,30,31,31,30,31,30,31][this.getMonth()]};Date.prototype._add=function(c){this.setDate(this.getDate()+c)};Date.prototype._first=function(){var c=new Date(this);c.setDate(1);
return c};Date.prototype._val=function(){this._clear();return{year:this.getFullYear(),month:this.getMonth(),date:this.getDate(),time:this.getTime(),day:this.getDay()}};Array.prototype._indexOf=function(c){return $.inArray(c,this)}})()})();