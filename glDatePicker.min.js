(function(){$.fn.glDatePicker=function(c){var A=this.data("glDatePicker");return A?!0===c?A:this:this.each(function(){return $(this).data("glDatePicker",new Q(this,c))})};$.fn.glDatePicker.defaults={cssName:"default",zIndex:1E3,borderSize:1,calendarOffset:{x:0,y:1},showAlways:!1,showAlwaysAlways:!1,resizeable:!0,hideOnClick:!0,allowMonthSelect:!0,allowYearSelect:!0,todayDate:new Date,selectedDate:null,prevArrow:"\u25c4",nextArrow:"\u25ba",selectableDates:null,selectableDateRange:null,specialDates:null,
selectableMonths:null,selectableYears:null,selectableDOW:null,monthNames:null,dowNames:null,dowOffset:0,onClick:function(c,A,d,g){c.val(d.toLocaleDateString())},onHold:function(c,A,d,g){c.val(d.toLocaleDateString())},onHover:function(c,A,d,g){},onShow:function(c){c.show()},onHide:function(c){c.hide()},firstDate:null};var Q=function(){function c(c,d){var g=this;g.el=$(c);var a=g.el;g.options=$.extend(!0,{},$.fn.glDatePicker.defaults,d);var e=g.options;g.calendar=$($.find("[gldp-el="+a.attr("gldp-id")+
" ]"));e.selectedDate=e.selectedDate||e.todayDate;e.firstDate=(new Date(e.firstDate||e.selectedDate))._first();(a.attr("gldp-id")||"").length||a.attr("gldp-id","gldp-"+Math.round(1E10*Math.random()));g.calendar.length&&!e.showAlways&&g.calendar.hide();$(document).bind("mouseup",function(c){c=c.target;var d=g.calendar;a.is(c)||(d.is(c)||0!==d.has(c).length||!d.is(":visible"))||g.hide()});g.render()}c.prototype={show:function(){$.each($(".gldp-el").not(this.el),function(c,d){if(d.length)d.options.onHide(d.calendar)});
this.options.onShow(this.calendar)},hide:function(){if(this.options&&!this.options.showAlways)this.options.onHide(this.calendar)},render:function(c){var d=this,g=d.el,a=d.options,e=d.calendar,r="gldp-"+a.cssName,v=a.todayDate._val(),w=v.time,l=a.borderSize+"px",B=function(a,f,c){for(var b=[],d=a;d<=f;d++)b.push(d);if(c){var e=[];$.each(c,function(c,b){b>=a&&(b<=f&&0>e._indexOf(b))&&e.push(b)});b=e.length?e:b}b.sort();return b},J=B(0,11,a.selectableMonths),x=B(v.year-5,v.year+5,a.selectableYears),
B=B(0,6,a.selectableDOW),C=a.dowNames||"Sun Mon Tue Wed Thu Fri Sat".split(" "),v=a.monthNames||"January February March April May June July August September October November December".split(" "),h=g.outerWidth(),b=h,k=function(n,f){return Math.floor(n/f+a.borderSize/f*(f-1))},h=k(h,7),b=k(b,8);e.length?eval(e.data("is"))||(h=e.outerWidth(),b=e.outerHeight(),h=k(h,7),b=k(b,8)):(d.calendar=e=$("<div/>").attr("gldp-el",g.attr("gldp-id")).data("is",!0).css({display:a.showAlways?void 0:"none",zIndex:a.zIndex,
width:7*h+"px"}),$("body").append(e));a.showAlwaysAlways||g.is(":visible")||e.hide();e.removeClass().addClass(r).children().remove();var r={width:h+"px",height:b+"px",lineHeight:b+"px"},k=function(n){var f=new Date(a.firstDate);for(n=n||0;;){f.setMonth(f.getMonth()+n);f.setDate(Math.min(1,f._max()));if(0==n)break;var b=f._val(),c=b.year;if(-1!=J._indexOf(b.month))if(-1!=x._indexOf(c))break;else if(c<x[0]||c>x[x.length-1])return null}return f},D=k(-1),E=k(1),k=a.firstDate=k(),b=k._val(),K=b.month,
L=b.year,k=new Date(k),b=Math.abs(Math.min(6,Math.max(0,a.dowOffset))),p=k.getDay()-b,p=1>p?-7-p:-p,C=C.concat(C).slice(b,b+7);k._add(p);b=$("<div/>").addClass(" core border monyear ").css($.extend({},r,{borderWidth:l+" 0 0 "+l})).append($("<a/>").addClass("prev-arrow"+(D?"":"-off")).html(a.prevArrow)).mousedown(function(){return!1}).click(function(n){""!=a.prevArrow&&D&&(n.stopPropagation(),D&&(a.firstDate=D,d.render()))});h=5*h-5*a.borderSize+a.borderSize;h=$("<div/>").addClass(" core border monyear title").css($.extend({},
r,{width:h+"px",borderTopWidth:l,marginLeft:"-"+l}));p=$("<div/>").addClass(" core border monyear ").css($.extend({},r,{marginLeft:"-"+l,borderWidth:l+" "+l+" 0 0"})).append($("<a/>").addClass("next-arrow"+(E?"":"-off")).html(a.nextArrow)).mousedown(function(){return!1}).click(function(n){""!=a.nextArrow&&E&&(n.stopPropagation(),E&&(a.firstDate=E,d.render()))});e.append(b).append(h).append(p);for(p=b=0;7>b;b++)for(var s=0;7>s;s++,p++){var F=new Date(k),m="day",t=a.zIndex+p,y=$("<div/>");if(b){F._add(s+
7*(b-1));var q=F._val(),z=q.time,M=null,u=!0,G=function(a,f){!0===a.repeatYear&&f.setYear(q.year);!0===a.repeatMonth&&f.setMonth(q.month);return f._val()};y.html(q.date);a.selectableDateRange&&(u=!1,$.each(a.selectableDateRange,function(a,f){var c=f.from,b=f.to||null,b=b||new Date(f.from.getFullYear(),f.from.getMonth(),f.from._max()),c=G(f,c),b=G(f,b);if(z>=c.time&&z<=b.time)return u=!0}));if(a.selectableDates){if(a.selectableDateRange&&!u||u&&!a.selectableDateRange)u=!1;$.each(a.selectableDates,
function(a,b){if(G(b,b.date).time==z)return u=!0})}!u||0>x._indexOf(q.year)||0>J._indexOf(q.month)||0>B._indexOf(q.day)?m="noday":(m="sun mon tue wed thu fri sat".split(" ")[q.day],K!=q.month&&(m+=" outday"),w==z&&(m="today",t+=50),a.specialDates&&$.each(a.specialDates,function(a,b){G(b,b.date).time==z&&(m=b.cssClass||"special",t+=52,M=b.data)}),a.selectedDate._time()==z&&(m+=" selected",t+=1E3),a.holdSelectDate&&(m+=" hold-selected"),y.on("click",function(b){b.stopPropagation();b=$(this).data("data");
a.selectedDate=a.firstDate=b.date;a=a.onClick(e,$(this),b.date,b.data);a.holdSelectDate=null;d.render(function(){!a.showAlways&&a.hideOnClick&&d.hide()})}).on("touchstart",function(b){var c=$(this).data("data");a.selectedDate=a.firstDate=c.date;$_this=$(this);timer=setTimeout(function(){a.holdSelectDate?(a=a.onClick(e,$_this,c.date,c.data),a.holdSelectDate=null):(a.holdSelectDate=a.selectedDate,a=a.onHold(e,$_this,c.date,c.data));d.render()},750)}).on("touchend",function(a){window.clearTimeout(timer)}).on("mousedown",
function(){return!1}).on("hover",function(b){b.stopPropagation();b=$(this).data("data");a.onHover(g,y,b.date,b.data)}))}else m="dow",y.html(C[s]),F=null;$.extend(r,{borderTopWidth:l,borderBottomWidth:l,borderLeftWidth:0<b||!b&&!s?l:0,borderRightWidth:0<b||!b&&6==s?l:0,marginLeft:0<s?"-"+l:0,marginTop:0<b?"-"+l:0,zIndex:t});y.data("data",{date:F,data:M}).addClass(" core border "+m).css(r);e.append(y)}var P=function(b){a.allowMonthSelect&&(N.css({display:b?"inline-block":"none"}),H.css({display:b?"none":
"inline-block"}));a.allowYearSelect&&(O.css({display:b?"none":"inline-block"}),I.css({display:b?"inline-block":"none"}))},w=function(){a.firstDate=new Date(I.val(),H.val(),1);d.render()},H=$("<select/>").hide().change(w),I=$("<select/>").hide().change(w),N=$("<span/>").html(v[K]).mousedown(function(){return!1}).click(function(a){a.stopPropagation();P(!1)}),O=$("<span/>").html(L).mousedown(function(){return!1}).click(function(a){a.stopPropagation();P(!0)});$.each(v,function(b,c){if(a.allowMonthSelect&&
-1!=J._indexOf(b)){var d=$("<option/>").html(c).attr("value",b);b==K&&d.attr("selected","selected");H.append(d)}});$.each(x,function(b,c){if(a.allowYearSelect){var d=$("<option/>").html(c).attr("value",c);c==L&&d.attr("selected","selected");I.append(d)}});w=$("<div/>").append(N).append(H).append(O).append(I);h.children().remove();h.append(w);(c||function(){})()}};return c}();(function(){Date.prototype._clear=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);
return this};Date.prototype._time=function(){return this._clear().getTime()};Date.prototype._max=function(){return[31,28+(1==(new Date(this.getYear(),1,29)).getMonth()?1:0),31,30,31,30,31,31,30,31,30,31][this.getMonth()]};Date.prototype._add=function(c){this.setDate(this.getDate()+c)};Date.prototype._first=function(){var c=new Date(this);c.setDate(1);return c};Date.prototype._val=function(){this._clear();return{year:this.getFullYear(),month:this.getMonth(),date:this.getDate(),time:this.getTime(),
day:this.getDay()}};Array.prototype._indexOf=function(c){return $.inArray(c,this)}})()})();